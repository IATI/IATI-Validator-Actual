<?xml version="1.0" encoding="UTF-8"?>
<project>
  <description>
    Developer targets
  </description>

  <!-- This extension point and linked targets could be moved to a separate engine and data volume -->
  <extension-point name="update-external-data"
  description="(Dev) Update the external data to use in the validator"
  depends="org-id-prefixes, mime-types, dstore-publishers"/>

  <target name="org-id-prefixes">
    <get src="http://org-id.guide/download.xml" dest="tmp/org-id.xml"/>
    <xslt in="tmp/org-id.xml" out="data/iati/org-id/prefixes.xml" style="lib/org-id-codes.xslt"/>
  </target>

  <target name="mime-types">
    <get src="http://www.iana.org/assignments/media-types/media-types.xml" dest="tmp/mime-types.xml"/>
    <xslt in="tmp/mime-types.xml" out="data-quality/lib/mime-types.xml" style="lib/mime-types.xslt"/>
  </target>

  <target name="dstore-publishers">
    <get src="https://github.com/devinit/D-Portal/raw/master/dstore/json/iati_codes.json" dest="tmp/dstore_iati_codes.json"/>
    <touch file="lib/dummy.xml"/>
    <xslt in="lib/dummy.xml" out="data-quality/lib/known-publishers.xml" style="lib/known-publishers.xslt"/>
  </target>

  <!-- Document all the Ant targets and their dependencies -->
  <typedef resource="net/ggtools/grand/antlib.xml" classpath="/develop/lib/grand-1.9.5.jar"/>
  <target name="ant-graph"
    description="(Dev) Create a graph of the targets and their dependencies.">
    <property name="dot.node.attributes" value="shape='box',fontname='sans-serif',fontsize='10',fillcolor='lightyellow',style='filled'"/>
    <property name="dot.link.attributes" value="fontname='sans-serif',fontsize='8',arrowsize='0.5',color='grey'"/>
    <property name="dot.mainnode.attributes" value="fillcolor='lightgreen'"/>
    <grand output="build.dot" outputconfigprefix="dot" showgraphname="true">
      <filter name="prefixed"/>
    </grand>

    <echo>
      Ant target graph available as engine/build.dot
      To create an SVG image fromt this, you need GraphViz and run
      'dot -Tsvg -o build.svg engine/build.dot'
    </echo>
  </target>
</project>
